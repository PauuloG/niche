# Niche

_Niche is a simple aliases management tool for Slack teams_

Niche was born from reading this great article from [@benbalter](https://github.com/benbalter) : [15 rules for communicating at GitHub](https://ben.balter.com/2014/11/06/rules-of-communicating-at-github/), and especially from this quote :
> Whenever possible, mention teams, not individuals, to distribute responsibility and situational awareness.

> In practice, that means creating a lot of niche teams (we have teams for affinities as small as Hubbers who play board games and Hubbers who are color blind), but if people can freely associate, the teams will populate quickly. 

Well, Slack offers just that with aliases, or `usergroups`, but the administration of those groups is not meant for teams to play around with. 

Creating, updating, or deleting aliases requires admin rights on the Slack organisation, and the feature is kind of buried in the Admin panel.

Niche aims at giving anyone the possibility to create their own niche-team that people can join freely.

## Installation

Niche is composed of a Symfony 4 app for the API, and a React front-end client. Niche comes with a docker environment that might be used for production, making the minimal installation process simpler.

### Slack app creation

Create a new [Slack app](https://api.slack.com/apps). Name it however you see fit. We will then setup the needed components and permissions needed.

#### OAuth and permissions 

This menu will enable you to get your API permissions and the OAuth token of your application (to communicate with your slack team). This token will be available once you install the app to your workspace.

In the Scopes section, chose the following permissions :
- `usergroups:read` #To sync usergroups
- `usergroups:write` # To manage usergroups
- `users:read` (for the app to be able to get the users list periodically)
- `users:read.email` (to add email to users list)

### Server-side installation

Niche's back-end is a Symfony 4 app.

First, clone the Niche repo. You must then copy the `.env.dist` file to `.env` and fill the various variables needed. They are pretty self explanatory.
Let's break the variables into two categories : Docker environment variables and Symfony parameters.

#### Docker environment variables 

```
MYSQL_DATA_DIR= //Directory mounted to the mysql container to persist db data
MYSQL_ROOT_PASSWORD= //Well mysql root password

APP_DIR= //Directory where your app is located on the host
APP_ENV= //App environment (should be prod)
```

#### Symfony parameters

```
APP_SECRET= //Automatically generated by Symfony, fill with any value really
DATABASE_URL="mysql://root:${MYSQL_ROOT_PASSWORD}@mysql.host:3306/mriqs" //We use the root user because we're inside the docker network so the mysql container is not reachable from anywhere public. Please use another user if your mysql install is publicly available.

SLACK_TOKEN=slackOauthToken
```

You can now run the app :
```
docker-compose up -d
```
This will install all dependencies and run your app. The app runs on port 80 by default.

## Usage

In order for the app to function normally, you can setup this crontab task : 

```
# This will update the list of users from Slack everyday to keep it in sync. You can also run this task less often or even manually.
0 0 * * * /usr/bin/docker exec -it niche-php php bin/console users:update
```

You should be good to go, go spread the love ðŸ’Œ!
